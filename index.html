<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gracey's Rewards</title>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      overflow-x: hidden;
    }

    #app {
      max-width: 900px;
      margin: 0 auto;
      padding: 1rem;
    }

    #pointsDisplay {
      font-size: 2.5rem;
      margin: 1rem 0;
    }

    #inputArea {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
      margin-bottom: 1rem;
    }

    #reasonInput {
      width: 90%;
      max-width: 500px;
      padding: 10px;
      font-size: 1.2rem;
      border-radius: 10px;
      border: none;
    }

    .pointButtons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .pointBtn {
      padding: 10px 20px;
      font-size: 1.1rem;
      border: none;
      border-radius: 10px;
      background: #333;
      color: white;
      cursor: pointer;
    }

    .pointBtn:hover {
      background: #555;
    }

    .logEntry {
      margin: 0.5rem 0;
    }

    .deleteBtn {
      background: red;
      border: none;
      color: white;
      margin-left: 1rem;
      padding: 2px 6px;
      border-radius: 4px;
      cursor: pointer;
    }

    #rewardPopup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      background: rgba(0, 0, 0, 0.85);
      padding: 20px;
      border-radius: 20px;
      z-index: 1000;
      display: none;
      text-align: center;
      animation: bounceIn 0.6s ease;
    }

    @keyframes bounceIn {
      0% {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 0;
      }
      60% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(1);
      }
    }

    #rewardPopup img {
      max-width: 200px;
      max-height: 200px;
      border-radius: 15px;
    }

    #passwordSection {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1000;
    }

    #passwordInput {
      padding: 5px 10px;
      border-radius: 8px;
      font-size: 1rem;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
      border: none;
    }

    #inventoryButton {
      margin-top: 1rem;
      padding: 10px 15px;
      border-radius: 10px;
      font-size: 1.1rem;
      background: #444;
      color: white;
      cursor: pointer;
      position: relative;
    }

    #inventoryButton.newReward::after {
      content: "!";
      position: absolute;
      top: -5px;
      right: -5px;
      background: gold;
      color: black;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #inventory {
      display: none;
      margin-top: 1.5rem;
    }

    .inventoryItem {
      display: inline-block;
      margin: 10px;
      text-align: center;
      max-width: 150px;
    }

    .inventoryItem img {
      max-width: 100%;
      max-height: 100px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .inventoryItem img:hover {
      transform: scale(1.1);
    }

    .inventoryItemName {
      margin-top: 0.3rem;
      font-weight: bold;
    }

    #devModeToggle {
      position: fixed;
      bottom: 10px;
      left: 10px;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 999;
    }

    #devSwitch {
      appearance: none;
      width: 50px;
      height: 25px;
      background: #333;
      border-radius: 15px;
      position: relative;
      cursor: pointer;
      transition: background 0.3s;
    }

    #devSwitch:checked {
      background: #0f0;
    }

    #devSwitch::before {
      content: "";
      position: absolute;
      top: 2px;
      left: 2px;
      width: 21px;
      height: 21px;
      border-radius: 50%;
      background: white;
      transition: transform 0.3s;
    }

    #devSwitch:checked::before {
      transform: translateX(25px);
    }

    @media (max-width: 600px) {
      #rewardPopup img {
        max-width: 100px;
        max-height: 100px;
      }

      .inventoryItem {
        max-width: 100px;
      }

      .inventoryItem img {
        max-height: 80px;
      }

      #reasonInput {
        font-size: 1rem;
      }

      #pointsDisplay {
        font-size: 1.8rem;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="passwordSection">
      <input type="password" id="passwordInput" placeholder="Password..." />
    </div>

    <div id="devModeToggle">
      <label for="devSwitch">Dev Mode</label>
      <input type="checkbox" id="devSwitch" />
    </div>

    <h1>Gracey's Rewards</h1>
    <div id="pointsDisplay">Points: 0</div>

    <div id="inputArea" style="display: none;">
      <input id="reasonInput" placeholder="Reason..." />
      <div class="pointButtons">
        <button class="pointBtn" data-points="1">+1</button>
        <button class="pointBtn" data-points="5">+5</button>
        <button class="pointBtn" data-points="10">+10</button>
      </div>
    </div>

    <div id="logArea"></div>

    <button id="inventoryButton">Show Inventory</button>
    <div id="inventory"></div>
  </div>

  <div id="rewardPopup">
    <div id="rewardPopupContent"></div>
  </div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <!-- App Logic Script -->
  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyD5BOVe3XXXXXXXXXXXXXX",
  authDomain: "gracey-s-rewards.firebaseapp.com",
  databaseURL: "https://gracey-s-rewards-default-rtdb.firebaseio.com",
  projectId: "gracey-s-rewards",
  storageBucket: "gracey-s-rewards.appspot.com",
  messagingSenderId: "000000000000",
  appId: "1:000000000000:web:xxxxxxxxxxxxxxxx"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const pointsDisplay = document.getElementById('pointsDisplay');
const reasonInput = document.getElementById('reasonInput');
const inputArea = document.getElementById('inputArea');
const logArea = document.getElementById('logArea');
const passwordInput = document.getElementById('passwordInput');
const inventoryButton = document.getElementById('inventoryButton');
const inventory = document.getElementById('inventory');
const rewardPopup = document.getElementById('rewardPopup');
const rewardPopupContent = document.getElementById('rewardPopupContent');
const devSwitch = document.getElementById('devSwitch');

let password = '';
let editUnlocked = false;
let devMode = false;
let currentPoints = 0;
let earnedRewards = {};
let showingPopup = false;
let popupQueue = [];
let popupRecentlyShown = {};

const rewards = [
  { points: 60, name: "Horror Anime T-Shirt", img: "URL1", sound: "scream", effect: "blood" },
  { points: 75, name: "Gothic Graphic Crop Top", img: "URL2", sound: "goth", effect: "glow" },
  { points: 95, name: "Striped Gothic Lace Shirt", img: "URL3", sound: "shimmer", effect: "angel" },
  { points: 115, name: "Metal Chain Belt", img: "URL4", sound: "chains", effect: "metal" },
  { points: 150, name: "Baby Girl Top", img: "URL5", sound: "whisper", effect: "pink" },
  {
    points: 150,
    name: "Mystic Butterfly Mug",
    img: "https://i.etsystatic.com/24694628/r/il/fa052b/5704527119/il_1588xN.5704527119_2zap.jpg",
    sound: "magical",
    effect: "sparkle"
  },
  {
    points: 150,
    name: "Marlboro Shadow T-Shirt",
    img: "URL6",
    sound: "scream",
    effect: "shadow"
  }
];

function getPath(base) {
  return devMode ? `dev/${base}` : base;
}

function loadData() {
  db.ref(getPath('points')).on('value', snap => {
    const val = snap.val() || 0;
    currentPoints = val;
    pointsDisplay.textContent = `Points: ${val}`;
    checkRewards();
  });

  db.ref(getPath('logs')).on('value', snap => {
    logArea.innerHTML = '';
    const logs = snap.val() || {};
    Object.entries(logs).forEach(([id, entry]) => {
      const div = document.createElement('div');
      div.className = 'logEntry';
      div.textContent = `${entry.reason} (+${entry.points})`;

      if (editUnlocked) {
        const del = document.createElement('button');
        del.textContent = 'X';
        del.className = 'deleteBtn';
        del.onclick = () => {
          db.ref(getPath('logs/' + id)).remove();
          db.ref(getPath('points')).set(currentPoints - entry.points);
        };
        div.appendChild(del);
      }

      logArea.appendChild(div);
    });
  });

  db.ref(getPath('earnedRewards')).on('value', snap => {
    earnedRewards = snap.val() || {};
    renderInventory();
  });
}

function addPoints(pts) {
  const reason = reasonInput.value.trim() || 'No reason';
  const entryRef = db.ref(getPath('logs')).push();
  entryRef.set({ reason, points: pts });
  db.ref(getPath('points')).set(currentPoints + pts);
  reasonInput.value = '';
}

function checkRewards() {
  rewards.forEach(r => {
    const alreadyEarned = earnedRewards[r.name];
    const shouldBeEarned = currentPoints >= r.points;

    if (shouldBeEarned && !alreadyEarned) {
      earnedRewards[r.name] = true;
      db.ref(getPath('earnedRewards/' + r.name)).set(true);
      showRewardPopup(r);
    } else if (!shouldBeEarned && alreadyEarned) {
      db.ref(getPath('earnedRewards/' + r.name)).remove();
    }
  });
}

function renderInventory() {
  inventory.innerHTML = '';
  let hasNew = false;
  rewards.forEach(r => {
    if (earnedRewards[r.name]) {
      const div = document.createElement('div');
      div.className = 'inventoryItem';
      const img = document.createElement('img');
      img.src = r.img;
      img.onclick = () => alert(r.name);
      const name = document.createElement('div');
      name.textContent = r.name;
      name.className = 'inventoryItemName';
      name.style.color = themedColor(r.effect);
      div.appendChild(img);
      div.appendChild(name);
      inventory.appendChild(div);
      hasNew = true;
    }
  });
  if (hasNew) inventoryButton.classList.add('newReward');
  else inventoryButton.classList.remove('newReward');
}

function showRewardPopup(reward) {
  if (popupRecentlyShown[reward.name]) return;
  popupQueue.push(reward);
  popupRecentlyShown[reward.name] = true;
  if (!showingPopup) processNextPopup();
}

function processNextPopup() {
  if (popupQueue.length === 0) {
    showingPopup = false;
    return;
  }

  showingPopup = true;
  const reward = popupQueue.shift();
  rewardPopupContent.innerHTML = `
    <h2>${reward.name}</h2>
    <img src="${reward.img}" />
  `;
  rewardPopup.style.display = 'block';
  applyEffect(reward.effect);

  const sound = new Audio(`sounds/${reward.sound}.mp3`);
  if (reward.name === "Marlboro Shadow T-Shirt") {
    setTimeout(() => applyEffect("shadow"), 1000);
    setTimeout(() => removeEffect("shadow"), 5000);
  }

  sound.play();
  sound.onended = () => {
    rewardPopup.style.display = 'none';
    removeEffect(reward.effect);
    showingPopup = false;
    processNextPopup();
  };

  setTimeout(() => {
    if (!sound.ended) {
      rewardPopup.style.display = 'none';
      removeEffect(reward.effect);
      showingPopup = false;
      processNextPopup();
    }
  }, 8000); // safety net
}

function applyEffect(effect) {
  switch (effect) {
    case 'blood': document.body.style.background = '#300'; break;
    case 'glow': document.body.style.boxShadow = '0 0 30px violet'; break;
    case 'angel': document.body.style.background = 'linear-gradient(white, gold)'; break;
    case 'metal': document.body.style.filter = 'grayscale(1)'; break;
    case 'pink': document.body.style.background = '#faa'; break;
    case 'sparkle': document.body.style.background = '#222 url("sparkle.gif") repeat'; break;
    case 'shadow': {
      document.body.style.transition = 'filter 0.5s';
      document.body.style.filter = 'brightness(0.3)';
      break;
    }
  }
}

function removeEffect(effect) {
  document.body.style = '';
}

function themedColor(effect) {
  switch (effect) {
    case 'blood': return 'red';
    case 'glow': return 'violet';
    case 'angel': return 'gold';
    case 'metal': return 'silver';
    case 'pink': return 'hotpink';
    case 'sparkle': return '#aaf';
    case 'shadow': return '#888';
    default: return 'white';
  }
}

document.querySelectorAll('.pointBtn').forEach(btn => {
  btn.onclick = () => {
    const pts = parseInt(btn.dataset.points);
    addPoints(pts);
  };
});

inventoryButton.onclick = () => {
  inventory.style.display = inventory.style.display === 'none' ? 'block' : 'none';
  inventoryButton.classList.remove('newReward');
};

passwordInput.addEventListener('change', () => {
  password = passwordInput.value;
  if (password === 'gracey') {
    editUnlocked = true;
    inputArea.style.display = 'flex';
    loadData();
  }
});

devSwitch.addEventListener('change', () => {
  devMode = devSwitch.checked;
  loadData();
});

loadData();

  </script>
</body>
</html>